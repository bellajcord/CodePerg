{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport React, { Children, cloneElement, isValidElement, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\nimport get from 'lodash/get';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport { makeStyles } from '@material-ui/core/styles';\nimport CloseIcon from '@material-ui/icons/RemoveCircleOutline';\nimport AddIcon from '@material-ui/icons/AddCircleOutline';\nimport { useTranslate, ValidationError } from 'ra-core';\nimport classNames from 'classnames';\nimport FormInput from '../form/FormInput';\nvar useStyles = makeStyles(function (theme) {\n  var _a, _b;\n\n  return {\n    root: {\n      padding: 0,\n      marginBottom: 0,\n      '& > li:last-child': {\n        borderBottom: 'none'\n      }\n    },\n    line: (_a = {\n      display: 'flex',\n      listStyleType: 'none',\n      borderBottom: \"solid 1px \" + theme.palette.divider\n    }, _a[theme.breakpoints.down('xs')] = {\n      display: 'block'\n    }, _a['&.fade-enter'] = {\n      opacity: 0.01,\n      transform: 'translateX(100vw)'\n    }, _a['&.fade-enter-active'] = {\n      opacity: 1,\n      transform: 'translateX(0)',\n      transition: 'all 500ms ease-in'\n    }, _a['&.fade-exit'] = {\n      opacity: 1,\n      transform: 'translateX(0)'\n    }, _a['&.fade-exit-active'] = {\n      opacity: 0.01,\n      transform: 'translateX(100vw)',\n      transition: 'all 500ms ease-in'\n    }, _a),\n    index: (_b = {\n      width: '3em',\n      paddingTop: '1em'\n    }, _b[theme.breakpoints.down('sm')] = {\n      display: 'none'\n    }, _b),\n    form: {\n      flex: 2\n    },\n    action: {\n      paddingTop: '0.5em'\n    },\n    leftIcon: {\n      marginRight: theme.spacing(1)\n    }\n  };\n}, {\n  name: 'RaSimpleFormIterator'\n});\n\nvar SimpleFormIterator = function (props) {\n  var basePath = props.basePath,\n      children = props.children,\n      fields = props.fields,\n      _a = props.meta,\n      error = _a.error,\n      submitFailed = _a.submitFailed,\n      record = props.record,\n      resource = props.resource,\n      source = props.source,\n      disableAdd = props.disableAdd,\n      disableRemove = props.disableRemove,\n      variant = props.variant,\n      margin = props.margin,\n      TransitionProps = props.TransitionProps,\n      defaultValue = props.defaultValue;\n  var translate = useTranslate();\n  var classes = useStyles(props); // We need a unique id for each field for a proper enter/exit animation\n  // so we keep an internal map between the field position and an auto-increment id\n\n  var nextId = useRef(fields && fields.length ? fields.length : defaultValue ? defaultValue.length : 0); // We check whether we have a defaultValue (which must be an array) before checking\n  // the fields prop which will always be empty for a new record.\n  // Without it, our ids wouldn't match the default value and we would get key warnings\n  // on the CssTransition element inside our render method\n\n  var ids = useRef(nextId > 0 ? Array.from(Array(nextId).keys()) : []);\n\n  var removeField = function (index) {\n    return function () {\n      ids.current.splice(index, 1);\n      fields.remove(index);\n    };\n  }; // Returns a boolean to indicate whether to disable the remove button for certain fields.\n  // If disableRemove is a function, then call the function with the current record to\n  // determining if the button should be disabled. Otherwise, use a boolean property that\n  // enables or disables the button for all of the fields.\n\n\n  var disableRemoveField = function (record, disableRemove) {\n    if (typeof disableRemove === 'boolean') {\n      return disableRemove;\n    }\n\n    return disableRemove && disableRemove(record);\n  };\n\n  var addField = function () {\n    ids.current.push(nextId.current++);\n    fields.push(undefined);\n  };\n\n  var records = get(record, source);\n  return fields ? React.createElement(\"ul\", {\n    className: classes.root\n  }, submitFailed && typeof error !== 'object' && error && React.createElement(FormHelperText, {\n    error: true\n  }, React.createElement(ValidationError, {\n    error: error\n  })), React.createElement(TransitionGroup, {\n    component: null\n  }, fields.map(function (member, index) {\n    return React.createElement(CSSTransition, __assign({\n      key: ids.current[index],\n      timeout: 500,\n      classNames: \"fade\"\n    }, TransitionProps), React.createElement(\"li\", {\n      className: classes.line\n    }, React.createElement(Typography, {\n      variant: \"body1\",\n      className: classes.index\n    }, index + 1), React.createElement(\"section\", {\n      className: classes.form\n    }, Children.map(children, function (input, index2) {\n      return isValidElement(input) ? React.createElement(FormInput, {\n        basePath: input.props.basePath || basePath,\n        input: cloneElement(input, {\n          source: input.props.source ? member + \".\" + input.props.source : member,\n          index: input.props.source ? undefined : index2,\n          label: typeof input.props.label === 'undefined' ? input.props.source ? \"resources.\" + resource + \".fields.\" + input.props.source : undefined : input.props.label\n        }),\n        record: records && records[index] || {},\n        resource: resource,\n        variant: variant,\n        margin: margin\n      }) : null;\n    })), !disableRemoveField(records && records[index] || {}, disableRemove) && React.createElement(\"span\", {\n      className: classes.action\n    }, React.createElement(Button, {\n      className: classNames('button-remove', \"button-remove-\" + source + \"-\" + index),\n      size: \"small\",\n      onClick: removeField(index)\n    }, React.createElement(CloseIcon, {\n      className: classes.leftIcon\n    }), translate('ra.action.remove')))));\n  })), !disableAdd && React.createElement(\"li\", {\n    className: classes.line\n  }, React.createElement(\"span\", {\n    className: classes.action\n  }, React.createElement(Button, {\n    className: classNames('button-add', \"button-add-\" + source),\n    size: \"small\",\n    onClick: addField\n  }, React.createElement(AddIcon, {\n    className: classes.leftIcon\n  }), translate('ra.action.add'))))) : null;\n};\n\nSimpleFormIterator.defaultProps = {\n  disableAdd: false,\n  disableRemove: false\n};\nSimpleFormIterator.propTypes = {\n  defaultValue: PropTypes.any,\n  basePath: PropTypes.string,\n  children: PropTypes.node,\n  classes: PropTypes.object,\n  className: PropTypes.string,\n  fields: PropTypes.object,\n  meta: PropTypes.object,\n  record: PropTypes.object,\n  source: PropTypes.string,\n  resource: PropTypes.string,\n  translate: PropTypes.func,\n  disableAdd: PropTypes.bool,\n  disableRemove: PropTypes.oneOfType([PropTypes.func, PropTypes.bool]),\n  TransitionProps: PropTypes.shape({})\n};\nexport default SimpleFormIterator;","map":null,"metadata":{},"sourceType":"module"}